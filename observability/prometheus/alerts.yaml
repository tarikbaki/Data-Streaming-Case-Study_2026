# Bu alert kurallarını çok detaylı yapmadım, temel şeyleri ekledim.
# Infra + Kafka + Connect tarafında en kritik metrikleri takip ediyorum.
# Prometheus'ta hızlıca sorun görmek için yeterli oluyor.

groups:

  - name: infra-alerts
    rules:

      - alert: InstanceDown
        expr: up == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Instance down"
          description: "Server {{ $labels.instance }} is unreachable"

      - alert: HighCPU
        expr: node_load1 > 0.8
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High CPU Load"
          description: "CPU load is high on {{ $labels.instance }}"

      - alert: LowDisk
        expr: (node_filesystem_avail_bytes/node_filesystem_size_bytes) < 0.20
        for: 1m
        labels:
          severity: critical
        annotations:
          description: "Disk space below 20%"

  - name: kafka-alerts
    rules:

      - alert: UnderReplicatedPartitions
        expr: kafka_server_replicamanager_underreplicatedpartitions > 0
        for: 1m
        labels:
          severity: critical
        annotations:
          description: "Under-replicated partitions detected"

      - alert: HighRequestLatency
        expr: kafka_network_requestmetrics_requestqueuetimems{quantile="0.95"} > 100
        for: 1m
        labels:
          severity: warning
        annotations:
          description: "p95 request latency above 100ms"


  - name: connect-alerts
    rules:

      - alert: ConnectTaskFailed
        expr: kafka_connect_worker_task_running_state == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          description: "Kafka Connect Task Failed"

      - alert: ProducerIncomingByteRateHigh
        expr: kafka_producer_metrics_incoming_byte_rate > 50000000
        for: 2m
        labels:
          severity: warning
        annotations:
          description: "High incoming byte rate"
