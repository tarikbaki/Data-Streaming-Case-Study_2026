# Bu dosyada broker ve controller için temel Kafka ayarlarını topladım.
# Güvenlik, KRaft config, JMX portları gibi şeyleri tek bir yerde tutayım dedim.
# cp-ansible hepsini buradan alıyor, ben de karışıklık olmadan yönetiyorum.

# ==========================
# GLOBAL SECURITY SETTINGS
# ==========================

ssl_enabled: true
sasl_protocol: "SASL_SSL"
sasl_mechanism: "SCRAM-SHA-512"
ssl_mutual_auth_enabled: false

# Basit self-signed keystore/truststore yollarını burada tutuyorum.
# Gerçekte bunları ansible vault ile şifreleyip dosya olarak dağıtmak gerekir.
ssl_keystore_filepath: "/etc/kafka/secrets/kafka.keystore.jks"
ssl_truststore_filepath: "/etc/kafka/secrets/kafka.truststore.jks"
ssl_keystore_password: "changeit"
ssl_truststore_password: "changeit"
ssl_key_password: "changeit"

# SASL user for brokers
kafka_broker:
  principal: "broker"
  sasl_users:
    - username: broker
      password: brokerpass

  config:
    process.roles: "broker"
    node.id: "{{ inventory_hostname | regex_findall('[0-9]+') | first }}"

    # listeners
    listeners: "SASL_SSL://:9092,CONTROLLER://:9093"
    advertised.listeners: "SASL_SSL://{{ ansible_host }}:9092"
    inter.broker.listener.name: "SASL_SSL"
    controller.listener.names: "CONTROLLER"

    # KRaft quorum voters
    controller.quorum.voters: >
      0@controller-0:9093,
      1@controller-1:9093,
      2@controller-2:9093

    # topic defaults
    num.partitions: 3

    # rack awareness (use AZ codes)
    broker.rack: "{{ hostvars[inventory_hostname].availability_zone | default('unset') }}"

# ==========================
# CONTROLLER CONFIG
# ==========================

kafka_controller:
  config:
    process.roles: "controller"
    node.id: "{{ inventory_hostname | regex_findall('[0-9]+') | first }}"
    listeners: "CONTROLLER://:9093"

    controller.quorum.voters: >
      0@controller-0:9093,
      1@controller-1:9093,
      2@controller-2:9093

# ==========================
# JMX EXPORTER
# ==========================
jmxexporter_enabled: true
kafka_broker_jmxexporter_port: 5555
kafka_controller_jmxexporter_port: 5556
